(()=>{"use strict";function t(t,s){return Math.floor(Math.random()*(s-t))+t}class s{constructor(t,s,i,e,h,o){this.hitBoxOffset={x:0,y:0},this.hitBoxScale={x:1,y:1},this.images=t,this.position=s,this.size=i,this.scale=e,this.canvas=document.getElementById(h),this.renderer=o,this.ctx=this.canvas.getContext("2d")}UpdateRender(t){null!==this.images&&(this.renderer.addElement(this.images[t],this.position,this.scale),this.size.x=this.images[t].width,this.size.y=this.images[t].height)}detectCollision(t,s,i,e){let h=t.position.x,o=t.position.x+t.size.x*t.scale.x,a=t.position.y,n=t.position.y+t.size.y*t.scale.y;!0===i&&(h=t.position.x+t.hitBoxOffset.x,o=t.position.x+(t.size.x*t.scale.x+t.hitBoxOffset.x)*t.hitBoxScale.x,a=t.position.y+t.hitBoxOffset.y,n=t.position.y+(t.size.y*t.scale.y+t.hitBoxOffset.y)*t.hitBoxScale.y);let c=s.position.x,l=s.position.x+s.size.x*s.scale.x,d=t.position.y,r=s.position.y+s.size.y*s.scale.y;return!0===e&&(c=s.position.x+s.hitBoxOffset.x,l=s.position.x+(s.size.x*s.scale.x+s.hitBoxOffset.x)*s.hitBoxScale.x,d=s.position.y+s.hitBoxOffset.y,r=s.position.y+(s.size.y*s.scale.y+s.hitBoxOffset.y)*s.hitBoxScale.y),!(n<d||a>r||o<c||h>l)}drawHitBox(){if(null===this.ctx)return;this.ctx.strokeStyle="green",this.ctx.lineWidth=3;let t=this.position.x,s=this.position.y;this.ctx.beginPath(),this.ctx.moveTo(t+this.hitBoxOffset.x,s+this.hitBoxOffset.y),this.ctx.lineTo(t+(this.size.x*this.scale.x+this.hitBoxOffset.x)*this.hitBoxScale.x,s+this.hitBoxOffset.y),this.ctx.lineTo(t+(this.size.x*this.scale.x+this.hitBoxOffset.x)*this.hitBoxScale.x,s+(this.size.y*this.scale.y+this.hitBoxOffset.y)*this.hitBoxScale.y),this.ctx.lineTo(t+this.hitBoxOffset.x,s+(this.size.y*this.scale.y+this.hitBoxOffset.y)*this.hitBoxScale.y),this.ctx.lineTo(t+this.hitBoxOffset.x,s+this.hitBoxOffset.y),this.ctx.closePath(),this.ctx.stroke()}}class i extends s{constructor(t,s,i,e,h,o){super(o.platformAssets,t,s,i,h,o),this.scoreRemoval=null,this.isExisted=!0,this.tempExisted=!0,this.monsterScale={x:1.3,y:1.3},this.state={x:0,y:0},this.speed={x:150,y:100},this.platformSpawnChances=[10,25,5,25,50,10,50,75,15],this.position=t,this.scene=e,this.tempScale=this.scale}SetSpawnPoint(t,s,i,e,h,o,a,n){this.segments=t,this.baseX=e,this.baseY=h,this.segmentHeight=o,this.segmentWidth=a,this.flexHeight=n,this.scoreRemoval=i,this.id=s}Update(t){!1!==this.tempExisted&&null!==this.images&&(this.UpdateNewPosition(),!1!==this.isExisted&&(this.UpdateBehaviour(t),this.UpdateRender(this.state.x)))}UpdateBehaviour(t){1===this.state.x&&this.BlueBehaviour(t,1===this.state.y)}BlueBehaviour(t,s){let i=this.speed.x;!1===s&&(i*=-1),this.position.x+=i*t}UpdateGravity(t){!1!==this.isExisted?this.position.y+=t:this.position={x:1e5,y:1e5}}UpdateNewPosition(){this.position.y>this.canvas.height&&this.ResetPosition(),1===this.state.x?(this.position.x>this.canvas.width&&(this.position.x-=1.2*this.canvas.width),this.position.x<2*-this.size.x&&(this.position.x=this.canvas.width)):(this.position.x>this.canvas.width/1.22&&(this.position.x-=this.canvas.width/1.22),this.position.x<-this.size.x&&(this.position.x=this.canvas.width/1.22))}ResetPosition(){this.position.y-=this.baseY,this.position.x=t(this.baseX-this.segmentWidth/2,this.baseX+this.segmentWidth/2),this.position.y=t(this.baseY-this.segmentHeight/2-this.flexHeight,this.baseY+this.segmentHeight/2+this.flexHeight),this.RandomizeNewPlatform(),null===this.scoreRemoval||this.scoreRemoval<this.scene.getScore()&&(this.scene.erasePlatform(this),this.isExisted=!1)}RandomizeNewPlatform(){this.tempExisted,this.state.x=0;let s=this.scene.getState(),i=0;this.scale=this.tempScale;let e=t(1,100);s>=1&&null!==this.scoreRemoval&&(i=this.platformSpawnChances[3*(s-1)+1],e<i&&(this.state.x=2,this.state.y=1)),e=t(1,100),s>=2&&(i=this.platformSpawnChances[3*(s-1)],e<i&&(this.state.x=1,this.state.y=1,e<i/2&&(this.state.y=2),console.log(i))),e=t(1,100),s>=3&&(i=this.platformSpawnChances[3*(s-1)+2],e<i&&(this.scale=this.monsterScale,this.state.x=3,this.state.y=1))}getState(){return!1===this.isExisted||!1===this.tempExisted?-1:this.state.x}temporaryRemove(){!1!==this.isExisted&&(this.tempExisted=!1)}}class e{constructor(s,e,h,o,a){this.gravityScale=1,this.platforms=[],this.score=0,this.checkPoint=5,this.checkPoints=[!1,!1,!1,!1,!1],this.checkScores=[2500,5e3,1e4,16e3,25e3],this.segments=5,this.state=0,this.game=s,this.doodle=e,this.gravityScale=h;let n=document.getElementById(o),c=n.height/4,l=n.width,d=c/20,r=l/2,x=c/2;for(let s=0;s<this.segments;s++){let e=t(r-l/2,r+l/2),h=t(x-c/6,x+c/6),n=new i({x:e,y:h},{x:62,y:17},{x:1.8,y:1.36},this,o,a);n.SetSpawnPoint(this.segments,this.platforms.length,null,r,x-(s+1)*c,c/6,l,0),this.platforms.push(n);for(let e=0;e<3;e++){let h=this.checkScores[this.checkPoint-1]+200*(e-1);e>0&&(h=this.checkScores[e-1]+200*(e-1));let n=t(r-l/2,r+l/2),p=t(x-c/2-d,x+c/2+d),g=new i({x:n,y:p},{x:62,y:17},{x:1.8,y:1.36},this,o,a);g.SetSpawnPoint(this.segments,this.platforms.length,h,r,x-(s+1)*c,c,l,d),this.platforms.push(g)}x+=c}}Update(t){this.doodle.UpdateGravity(this.gravityScale),this.UpdateCollision(t),this.UpdateScore()}UpdateCollision(t){for(const s of this.platforms)-1!==s.getState()&&(s.Update(t),this.doodle.detectCollision(s,this.doodle,!1,!0)&&(3===s.getState()?-1===this.doodle.MonsterJump()?this.gameOver():s.temporaryRemove():2===s.getState()?this.doodle.FallingLowJump():this.doodle.FallingJump()),s.UpdateGravity(-this.doodle.exceedSpeed.y))}UpdateScore(){this.score-=this.doodle.exceedSpeed.y,this.doodle.exceedSpeed.y=0;for(let t=0;t<this.checkPoint;t++)this.score>this.checkScores[t]&&!1===this.checkPoints[t]&&t>=1&&(this.checkPoints[t]=!0,this.state++);-1===this.doodle.getState()&&this.gameOver()}gameOver(){this.game.gameOver()}getScore(){return this.score}erasePlatform(t){this.platforms.filter((s=>s.id===t.id),1)}getState(){return this.state}}class h extends s{constructor(t,s,i,e,h,o){super(o.doodleAssets,t,s,i,h,o),this.speed={x:0,y:0},this.exceedSpeed={x:0,y:0},this.isMovingLeft=!1,this.isMovingRight=!1,this.isLookingRight=!0,this.isMaxHeight=!1,this.maxHeight=300,this.speedMultiplier=1,this.state=0,this.baseSpeed=e,this.hitBoxOffset={x:15,y:60},this.hitBoxScale={x:.5,y:.5}}Update(t){null!=this.ctx&&(this.addKeyListeners(),this.UpdateVelocity(),this.UpdateMovement(t),this.UpdatePosition(),this.UpdateId())}SuperJump(){this.speed.y>0&&this.Jump(2)}FallingLowJump(){this.speed.y>0&&this.Jump(.7)}MonsterJump(){return this.speed.y>0?(this.Jump(1),0):-1}Jump(t){this.speed.y=-this.baseSpeed.y*t}FallingJump(){this.speed.y>0&&this.Jump(1)}UpdateMovement(t){0!==this.state&&(this.position.y<this.maxHeight?this.isMaxHeight=!0:this.isMaxHeight=!1,t*=this.speedMultiplier,this.position.x+=this.speed.x*t,!1===this.isMaxHeight||this.speed.y>0?this.position.y+=this.speed.y*t:this.exceedSpeed.y=this.speed.y*t)}UpdatePosition(){this.position.y>this.canvas.height&&(this.state=-1),this.position.x>this.canvas.width&&(this.position.x=-this.size.x/4),this.position.x<-this.size.x/4&&(this.position.x=this.canvas.width)}UpdateId(){let t=0;!1===this.isLookingRight&&(t=1),this.UpdateRender(t)}UpdateGravity(t){this.speed.y+=t}UpdateVelocity(){!0===this.isMovingLeft&&(this.speed.x=-this.baseSpeed.x,this.isLookingRight=!1,this.switchLeft()),!0===this.isMovingRight&&(this.speed.x=this.baseSpeed.x,this.isLookingRight=!0,this.switchRight()),!1===this.isMovingLeft&&!1===this.isMovingRight&&(this.speed.x=0)}getMaxHeightStatus(){return this.isMaxHeight}addKeyListeners(){window.addEventListener("keydown",(t=>{!1===this.isMovingLeft&&("KeyA"!==t.code&&"ArrowLeft"!==t.code||(this.isMovingLeft=!0)),!1===this.isMovingRight&&("KeyD"!==t.code&&"ArrowRight"!==t.code||(this.isMovingRight=!0)),"KeyW"===t.code||t.code})),window.addEventListener("keyup",(t=>{!0===this.isMovingLeft&&("KeyA"!==t.code&&"ArrowLeft"!==t.code||(this.isMovingLeft=!1)),!0===this.isMovingRight&&("KeyD"!==t.code&&"ArrowRight"!==t.code||(this.isMovingRight=!1))}))}switchRight(){this.hitBoxOffset={x:15,y:60},this.hitBoxScale={x:.5,y:.5}}switchLeft(){this.hitBoxOffset={x:32,y:60},this.hitBoxScale={x:.5,y:.5}}getState(){return this.state}setState(t){this.state=t}}class o{constructor(t){this.prevScore=0,this.elements=[],this.imagePaths=["assets/game/BG.png","assets/game/Doodle.png","assets/game/Doodle_Left.png","assets/game/platform1_3.png","assets/game/platform2.png","assets/game/platform3.png","assets/game/platform4.png"],this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d");const s=this.pathsToImg(this.imagePaths);this.backgroundAssets=[s[0]],this.doodleAssets=[s[1],s[2]],this.platformAssets=[s[3],s[4],s[5],s[6]]}setScene(t){this.scene=t}Update(){0!==this.backgroundAssets.length&&this.addElement(this.backgroundAssets[0],{x:0,y:0},{x:1,y:1}),this.drawElements(),this.elements.length=0,this.drawScore()}drawScore(){if(null===this.ctx)return;this.ctx.font="48px serif",this.ctx.fillStyle="blue";let t=this.scene.getScore();t=Math.floor(t),0===t?this.ctx.fillText(this.prevScore.toString(),10,50):(this.prevScore=t,this.ctx.fillText(t.toString(),10,50))}addElement(t,s,i){const e={x:t.width*i.x,y:t.height*i.y};this.elements.push({image:t,position:s,scale:i,size:e})}drawImage(t,s,i){if(null===this.ctx)return;const e=t.width*i.x,h=t.height*i.y;this.ctx.drawImage(t,s.x,s.y,e,h)}drawHitBox(t,s,i){if(null===this.ctx)return;this.ctx.strokeStyle="green",this.ctx.lineWidth=3;let e=s.x,h=s.y;this.ctx.beginPath(),this.ctx.moveTo(e,h),this.ctx.lineTo(e+t.width*i.x,h),this.ctx.lineTo(e+t.width*i.x,h+t.height*i.y),this.ctx.lineTo(e,h+t.height*i.y),this.ctx.lineTo(e,h),this.ctx.closePath(),this.ctx.stroke()}drawElements(){if(this.ctx){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(let t=this.elements.length-1;t>=0;t--)this.drawImage(this.elements[t].image,this.elements[t].position,this.elements[t].scale)}}pathToImg(t){const s=new Image;return s.src=t,s}pathsToImg(t){let s=[];return t.forEach((t=>{const i=this.pathToImg(t);s.push(i)})),s}}(new class{constructor(){this.canvasId="game-canvas",this.buttonId="myButton",this.lastTime=0,this.isPlaying=!1,this.currentScore=0,this.highScore=0,this.menuLoop=this.menuLoop.bind(this),this.isPlaying=!1}gameLoop(t){const s=(t-this.lastTime)/1e3;this.lastTime=t,this.doodle.Update(s),this.scene.Update(s),this.renderer.Update(),this.currentScore=Math.floor(this.scene.getScore()),!0===this.isPlaying?window.requestAnimationFrame(this.gameLoop):window.requestAnimationFrame(this.menuLoop)}menuLoop(){if(!0===this.isPlaying)window.requestAnimationFrame(this.gameLoop);else{let t=document.getElementById("myButton");t.textContent="PLAY",t.style.backgroundImage="assets/game/play.jpg",t.style.display="inline",t.disabled=!1;let s=document.getElementById("myButton2");s.textContent="Current score: "+this.currentScore+"\nHigh Score: "+this.highScore,s.disabled=!0,s.style.display="inline",t.addEventListener("click",(()=>{this.gameLoop=this.gameLoop.bind(this),this.renderer=new o(this.canvasId),this.doodle=new h({x:220,y:400},{x:50,y:100},{x:.2,y:.2},{x:350,y:800},this.canvasId,this.renderer),this.scene=new e(this,this.doodle,20,this.canvasId,this.renderer),this.renderer.setScene(this.scene),this.isPlaying=!0,this.doodle.setState(1),t.disabled=!0,t.style.display="none",s.disabled=!0,s.style.display="none"})),window.requestAnimationFrame(this.menuLoop)}}start(){window.requestAnimationFrame(this.menuLoop)}gameOver(){this.currentScore>this.highScore&&(this.highScore=this.currentScore),this.isPlaying=!1}}).start()})();